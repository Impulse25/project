# üéì –°–í–ì–¢–ö - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ –¥–ª—è –°—Ç–µ–ø–Ω–æ–≥–æ—Ä—Å–∫–æ–≥–æ –≤—ã—Å—à–µ–≥–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–ª–ª–µ–¥–∂–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π LDAP/Active Directory.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: LDAP (–¥–æ–º–µ–Ω shc.local) + –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î
- üìä **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—Ö–æ–¥—ã, –≤—ã—Ö–æ–¥—ã, –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- üë• **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**: —Ä–æ–ª–∏, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- üìù **–°–∏—Å—Ç–µ–º–∞ –∑–∞—è–≤–æ–∫**: —Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- üåê **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å**: –†—É—Å—Å–∫–∏–π, –ö–∞–∑–∞—Ö—Å–∫–∏–π
- üìà **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã**: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4+
- MySQL 5.7+ / MariaDB 10.3+
- Apache / Nginx
- PHP LDAP –º–æ–¥—É–ª—å (–¥–ª—è –¥–æ–º–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/–≤–∞—à-username/svgtk-requests.git
cd svgtk-requests
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```sql
CREATE DATABASE svgtk_requests CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
mysql -u root -p svgtk_requests < migrations/migration_add_ldap_support.sql
mysql -u root -p svgtk_requests < migrations/migration_add_auth_type_to_logs.sql
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `config/db.php`:
```php
<?php
$host = 'localhost';
$dbname = 'svgtk_requests';
$username = 'root';
$password = '–≤–∞—à_–ø–∞—Ä–æ–ª—å';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8mb4", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $pdo->setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);
} catch (PDOException $e) {
    die("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: " . $e->getMessage());
}
?>
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LDAP (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–§–∞–π–ª `config/ldap.php` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –¥–æ–º–µ–Ω–∞ **shc.local**.

–ï—Å–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω –¥—Ä—É–≥–æ–π, –∏–∑–º–µ–Ω–∏—Ç–µ:
```php
define('LDAP_SERVER', 'ldap://172.12.0.16'); // IP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ–º–µ–Ω–∞
define('LDAP_BASE_DN', 'dc=shc,dc=local');   // Base DN
```

–î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è LDAP:
```php
define('LDAP_ENABLED', false);
```

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```bash
php setup_local_admin.php
```

**–î–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- –õ–æ–≥–∏–Ω: `local_admin`
- –ü–∞—Ä–æ–ª—å: `Admin2025!`

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ LDAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
php test_ldap.php

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
php test_logging.php
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
svgtk-requests/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ db.php              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î (—Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é)
‚îÇ   ‚îî‚îÄ‚îÄ ldap.php            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LDAP/AD
‚îú‚îÄ‚îÄ includes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.php            # –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ language.php        # –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ migration_add_ldap_support.sql
‚îÇ   ‚îî‚îÄ‚îÄ migration_add_auth_type_to_logs.sql
‚îú‚îÄ‚îÄ admin_dashboard.php     # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îú‚îÄ‚îÄ admin_logs.php          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ logout.php              # –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ index.php               # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ README.md
```

## üîê –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. **LDAP (–î–æ–º–µ–Ω shc.local)**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ AD
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –§–ò–û
   - –†–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `teacher`

2. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î**
   - –†–µ–∑–µ—Ä–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø (local_admin)
   - –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –¥–æ–º–µ–Ω–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```
–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞
    ‚Üì
1. LDAP (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
    ‚Üì
    –£—Å–ø–µ—à–Ω–æ? ‚Üí –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω
    ‚Üì
    –ù–µ—É–¥–∞—á–Ω–æ?
    ‚Üì
2. –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î
    ‚Üì
    –ù–∞–π–¥–µ–Ω? ‚Üí –í—Ö–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ
    ‚Üì
    –ù–µ –Ω–∞–π–¥–µ–Ω? ‚Üí –û—Ç–∫–∞–∑
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `user_logs`:

- ‚úÖ –í—Ö–æ–¥—ã (—É—Å–ø–µ—à–Ω—ã–µ)
- ‚ùå –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
- üö™ –í—ã—Ö–æ–¥—ã
- üìù –¢–∏–ø –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (LDAP/Local)
- üåê IP –∞–¥—Ä–µ—Å –∏ User-Agent
- ‚è∞ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –¥–µ–π—Å—Ç–≤–∏–π
SELECT * FROM user_logs ORDER BY created_at DESC LIMIT 20;

-- –í—Å–µ LDAP –≤—Ö–æ–¥—ã
SELECT * FROM user_logs WHERE auth_type = 'ldap' AND action = 'login';

-- –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM user_logs 
WHERE success = 0 AND DATE(created_at) = CURDATE();
```

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –†–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- **admin** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- **director** - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **teacher** - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫
- **technician** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```sql
-- –°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–æ–º
UPDATE users 
SET role = 'admin' 
WHERE username = 'ivanov' AND auth_type = 'ldap';
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
INSERT INTO users (username, password, full_name, role, auth_type, created_at)
VALUES (
    'testuser',
    '$2y$10$...',  -- password_hash('password', PASSWORD_DEFAULT)
    '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    'teacher',
    'local',
    NOW()
);
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

### Apache (.htaccess)

```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?route=$1 [QSA,L]

# –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
<FilesMatch "^(db|ldap)\.php$">
    Require all denied
</FilesMatch>
```

### Nginx

```nginx
server {
    listen 80;
    server_name svgtk.local;
    root /var/www/svgtk-requests;
    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }

    location ~ ^/(config|includes)/.*\.php$ {
        deny all;
    }
}
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### LDAP –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å
ping 172.12.0.16
telnet 172.12.0.16 389

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PHP –º–æ–¥—É–ª—å
php -m | grep ldap

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ—Å–ª–∏ –Ω–µ—Ç
sudo apt-get install php-ldap
sudo systemctl restart apache2
```

### –õ–æ–≥–∏ –Ω–µ –ø–∏—à—É—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É
mysql -u root -p -e "USE svgtk_requests; SHOW TABLES LIKE '%log%';"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞
mysql -u root -p -e "USE svgtk_requests; SHOW GRANTS FOR 'user'@'localhost';"
```

### –ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø:
- –õ–æ–≥–∏–Ω: `local_admin`
- –ü–∞—Ä–æ–ª—å: `Admin2025!`

## üìù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```php
// –í –≤–∞—à–µ–º –∫–æ–¥–µ
logUserAction(
    $pdo,
    $userId,
    $username,
    $fullName,
    $role,
    'custom_action',  // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
    $authType,
    true              // –£—Å–ø–µ—à–Ω–æ –∏–ª–∏ –Ω–µ—Ç
);
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–æ–ª–∏

```sql
INSERT INTO roles (role_code, role_name_ru, role_name_kk, description)
VALUES ('manager', '–ú–µ–Ω–µ–¥–∂–µ—Ä', '–ú–µ–Ω–µ–¥–∂–µ—Ä', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏');
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary - –°—Ç–µ–ø–Ω–æ–≥–æ—Ä—Å–∫–∏–π –≤—ã—Å—à–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–ª–ª–µ–¥–∂

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä—ã

- –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ - –°–í–ì–¢–ö IT –æ—Ç–¥–µ–ª
- LDAP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - 2025

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ IT –æ—Ç–¥–µ–ª –∫–æ–ª–ª–µ–¥–∂–∞.

---

**–í–µ—Ä—Å–∏—è:** 2.0 (—Å LDAP –∏ –ø–æ–ª–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)  
**–î–∞—Ç–∞:** 2025-10-28  
**–î–æ–º–µ–Ω:** shc.local
